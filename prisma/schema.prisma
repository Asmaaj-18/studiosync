generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ===================== USERS =====================
 */
model users {
  id             String   @id @default(cuid())
  email          String   @unique
  password       String
  first_name     String
  last_name      String
  phone          String?
  avatar         String?
  role           UserRole @default(ARTIST)
  is_active      Boolean  @default(true)
  email_verified Boolean  @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  studios                  studios[]
  reservations             reservations[]
  equipment_bookings       equipment_bookings[]
  reservation_participants reservation_participants[]
  notifications            notifications[]
  files                    files[]
}

/**
 * ===================== STUDIOS =====================
 */
model studios {
  id          String  @id @default(cuid())
  name        String
  description String?
  address     String
  city        String
  postal_code String
  country     String
  capacity    Int
  hourly_rate Decimal @db.Decimal(10, 2)
  currency    String  @default("EUR")
  is_active   Boolean @default(true)
  owner_id    String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  users                 users                   @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  equipment             equipment[]
  reservations          reservations[]
  projects              projects[]
  studio_availabilities studio_availabilities[]

  @@index([city, country])
  @@index([owner_id])
}

/**
 * ===================== EQUIPMENT =====================
 */
model equipment {
  id          String          @id @default(cuid())
  name        String
  description String?
  brand       String?
  model       String?
  type        EquipmentType
  status      EquipmentStatus @default(AVAILABLE)
  hourly_rate Decimal?        @db.Decimal(10, 2)
  daily_rate  Decimal?        @db.Decimal(10, 2)
  studio_id   String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  studios            studios              @relation(fields: [studio_id], references: [id], onDelete: Cascade)
  equipment_bookings equipment_bookings[]
}

/**
 * ===================== STUDIO AVAILABILITIES =====================
 */
model studio_availabilities {
  id           String   @id @default(cuid())
  studio_id    String
  day_of_week  Int
  opening_time DateTime @db.Time(6)
  closing_time DateTime @db.Time(6)
  is_available Boolean  @default(true)

  studios studios @relation(fields: [studio_id], references: [id], onDelete: Cascade)

  @@unique([studio_id, day_of_week])
}

/**
 * ===================== RESERVATIONS =====================
 */
model reservations {
  id          String            @id @default(cuid())
  title       String
  description String?
  start_time  DateTime          @db.Timestamptz(6)
  end_time    DateTime          @db.Timestamptz(6)
  status      ReservationStatus @default(PENDING)
  total_price Decimal           @db.Decimal(10, 2)
  currency    String            @default("EUR")
  studio_id   String
  created_by  String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  studios                  studios                    @relation(fields: [studio_id], references: [id], onDelete: Cascade)
  users                    users                      @relation(fields: [created_by], references: [id], onDelete: Cascade)
  reservation_participants reservation_participants[]
  equipment_bookings       equipment_bookings[]
  payments                 payments?
  projects                 projects[] // âœ… relation OK maintenant
}

/**
 * ===================== PARTICIPANTS =====================
 */
model reservation_participants {
  id             String          @id @default(cuid())
  reservation_id String
  user_id        String
  role           ParticipantRole @default(MUSICIAN)

  reservations reservations @relation(fields: [reservation_id], references: [id], onDelete: Cascade)
  users        users        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([reservation_id, user_id])
}

/**
 * ===================== EQUIPMENT BOOKINGS =====================
 */
model equipment_bookings {
  id             String        @id @default(cuid())
  reservation_id String
  equipment_id   String
  quantity       Int
  start_time     DateTime      @db.Timestamptz(6)
  end_time       DateTime      @db.Timestamptz(6)
  status         BookingStatus @default(RESERVED)
  user_id        String?

  reservations reservations @relation(fields: [reservation_id], references: [id], onDelete: Cascade)
  equipment    equipment    @relation(fields: [equipment_id], references: [id], onDelete: Cascade)
  users        users?       @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([reservation_id, equipment_id])
}

/**
 * ===================== PAYMENTS =====================
 */
model payments {
  id             String        @id @default(cuid())
  reservation_id String        @unique
  amount         Decimal       @db.Decimal(10, 2)
  currency       String        @default("EUR")
  status         PaymentStatus @default(PENDING)
  payment_method String?
  paid_at        DateTime?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  reservations reservations @relation(fields: [reservation_id], references: [id], onDelete: Cascade)
}

/**
 * ===================== PROJECTS =====================
 */
model projects {
  id          String        @id @default(cuid())
  name        String
  description String?
  status      ProjectStatus @default(RECORDING)

  studio_id      String?
  reservation_id String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  studios      studios?      @relation(fields: [studio_id], references: [id], onDelete: Cascade)
  reservations reservations? @relation(fields: [reservation_id], references: [id], onDelete: SetNull)
  files        files[]

  @@index([studio_id])
  @@index([reservation_id])
}

/**
 * ===================== FILES =====================
 */
model files {
  id          String   @id @default(cuid())
  name        String
  url         String
  type        FileType
  project_id  String
  uploaded_by String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  projects projects @relation(fields: [project_id], references: [id], onDelete: Cascade)
  users    users    @relation(fields: [uploaded_by], references: [id], onDelete: Cascade)
}

/**
 * ===================== NOTIFICATIONS =====================
 */
model notifications {
  id      String           @id @default(cuid())
  user_id String
  type    NotificationType
  title   String
  message String
  is_read Boolean          @default(false)

  created_at DateTime @default(now())

  users users @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

/**
 * ===================== ENUMS =====================
 */
enum UserRole {
  ADMIN
  STUDIO_OWNER
  ARTIST
  TECHNICIAN
}

enum EquipmentType {
  MICROPHONE
  MIXING_CONSOLE
  AUDIO_INTERFACE
  INSTRUMENT
}

enum EquipmentStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  OUT_OF_ORDER
}

enum BookingStatus {
  RESERVED
  IN_USE
  RETURNED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum ParticipantRole {
  PRODUCER
  ENGINEER
  MUSICIAN
}

enum ProjectStatus {
  RECORDING
  MIXING
  MASTERING
  COMPLETED
}

enum FileType {
  AUDIO
  DOCUMENT
  IMAGE
}

enum NotificationType {
  RESERVATION_CONFIRMED
  PAYMENT_RECEIVED
}
